# Leaflet JS

Leaflet.js est une biblioth√®que JavaScript open-source proposant aux d√©veloppeurs une mise en place facile de cartes int√©ractives, et compatibles mobile.

Tr√®s l√©g√®re, elle ne p√®se que 42Kb seule et dispose de toutes les fonctionnalit√©s d'une carte int√©ractive, √† savoir :

- Tile layers (calques de tuiles)
- Markers
- Popups 
- Vector layers (polylines, polygones, cercles, rectangles)
- Image overlays
- GeoJSON

De plus, la biblioth√®que est tr√®s performante et tire partie de l'acc√©l√©ration mat√©rielle sur mobile, et des features CSS3 pour rendre les animations plus fluides.

---

## 1. Installer la biblioth√®que sur une page web

On l'installe en incluant dans la page 2 choses :

- la CSS de Leaflet
- le JS de Leaflet

**La CSS** :

```html
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.1/dist/leaflet.css"
     integrity="sha256-sA+zWATbFveLLNqWO2gtiw3HL/lh1giY/Inf1BJ0z14="
     crossorigin="" />
```

**Le JavaScript** :

```html
<!-- √Ä inclure APR√àS la CSS ! -->
 <script src="https://unpkg.com/leaflet@1.9.1/dist/leaflet.js"
     integrity="sha256-NDI0K41gVbWqfkkaHj15IzU7PtMoelkzyKp8TOaFQ3s="
     crossorigin=""></script>
```

Puis, on pr√©pare une `<div>` dans la page HTML pour l'emplacement de la carte :

```html
<div id="myMap"></div>
```

On lui d√©finit une hauteur quelconque en CSS :

```css
#myMap {
    height: 180px;
}
```

La page HTML est pr√™te pour accueillir la carte. Il va maintenant falloir faire l'initialisation en JS.

## 2. Initialiser la map

La biblioth√®que vous fourni un objet global JavaScript nomm√© simplement : `L`

Dans cet objet global se trouvent l'ensemble des objets pour g√©rer les cartes.

Par exemple, pour d√©clarer une nouvelle carte, on fait appel √† l'objet : `L.map()` :

```js
const mapObject = L.map('myMap')
                .setView([48.866667, 2.333333], 11);
```

Ici, on cr√©e une nouvelle constante `mapObject` qui repr√©sente l'objet de carte, et on lui indique le nom de la div HTML `myMap` dans laquelle s'afficher.

Puis, on encha√Æne avec la m√©thode `.setView()` pour pr√©ciser :

1. Les coordonn√©es de latitude et longitude (ici, c'est Paris ü§û)
2. Le niveau de zoom `11` (0 = zoom minimum)

##### Testez le r√©sultat dans votre navigateur. Que remarquez-vous ?

## 3. Utiliser des layers (calques)

Pour l'instant, aucune map ne s'affiche dans la zone pr√©vue √† cet effet :

![](./images/empty-map.png)

En effet, Leaflet.js fonctionne sur le principe de layers (calques) pour afficher une map.

Il en existe de toutes sortes et tout styles (gratuites comme payantes), et par d√©faut, le service **OpenStreetMap** en fournit un gratuit.

Un layer est g√©n√©ralement d√©fini par une URL "template" form√©e de la sorte :

```
https://tile.openstreetmap.org/{z}/{x}/{y}.png
```

> Pour plus de d√©tails sur le fonctionnement technique, consultez la page suivante : https://leafletjs.com/reference.html#tilelayer-url-template

On ajoute un layer avec la m√©thode `tileLayer` comme ceci :

```js
L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19,
    attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
}).addTo(mapObject);
```

On indique qu'on ajoute le layer `https://tile.openstreetmap.org/{z}/{x}/{y}.png`, que l'on param√®tre avec un zoom maximum de 19, et un texte d'attribution pour le copyright (ce qui est souvent demand√© lorsqu'on vous propose des services de layer gratuits : c'est de l'open source, merci donc de respecter les attributions obligatoires).

On associe enfin le layer √† l'objet `mapObject` repr√©sentant notre carte, et on obtient le r√©sultat suivant :

![](./images/map.png)

---

D'autres services proposent des layers gratuits, par exemple [Stamen](http://maps.stamen.com/), [Thunderforest](https://www.thunderforest.com/terms/) et [Mapbox](https://docs.mapbox.com/help/how-mapbox-works/attribution/).


#### Stamen 

Stamen propose les layers suivants compl√®tements gratuits et sans token (attention, certains ne sont pas disponibles sur toutes les zones g√©ographiques !):

- `https://stamen-tiles.a.ssl.fastly.net/toner/{z}/{x}/{y}.png`
- `https://stamen-tiles.a.ssl.fastly.net/terrain/{z}/{x}/{y}.jpg`
- `https://stamen-tiles.a.ssl.fastly.net/watercolor/{z}/{x}/{y}.jpg`

Voir la page : http://maps.stamen.com/#toner/12/37.7707/-122.3781

Testez-les dans la page HTML.

#### Thunderforest

Thunderforest propose √©galement des layers gratuits, mais vous aurez besoin d'un **token** en vous inscrivant gratuitement sur leur site. Une fois votre token obtenu, vous pourrez l'ins√©rer dans l'URL de template.

Plus d'informations ici :

https://www.thunderforest.com/maps/

#### Mapbox

Mapbox fonctionne sur le m√™me principe que Thunderforest et n√©cessite un token gratuit.

Plus d'informations ici :

https://docs.mapbox.com/help/getting-started/mapbox-data/#map-data

Voici une URL que vous pourrez tester lorsque vous aurez votre token mapbox :

- `https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=<VOTRE_TOKEN>`

(Vous mettrez la valeur `mapbox.satellite` pour le param√®tre `{id}`)

##### Quel type de layer s'affiche ?

---

## 4. Challenge : Dessiner des formes simples

Vous pouvez dessiner des formes simples comme des cercles, des polygones et des marqueurs avec popup.

Voici la page explicative pour cela :

https://leafletjs.com/examples/quick-start/#markers-circles-and-polygons

En vous aidant de cette page, faites-en sorte de :

- centrer la map sur l'IUT de Champs-sur-Marne
- ajouter un marqueur cliquable sur l'IUT, mentionnant l'adresse postale
- ajoutez un cercle ciblant exactement la zone de parking ext√©rieure de l'IUT
- cr√©ez un polygone d√©limitant les contours du b√¢timent de l'IUT

Vous devriez obtenir le r√©sultat suivant :

![](./images/iut.png)

### 5. Layer groups

Lisez le tutoriel suivant : https://leafletjs.com/examples/layers-control/

Ajoutez plusieurs calques avec un menu pour switcher entre eux.

![](./images/layer-groups.gif)

Vous aurez besoin d'un **Layer Control** (il s'agit du petit bouton situ√© en haut √† droite de votre map pour afficher/masquer les diff√©rents calques)